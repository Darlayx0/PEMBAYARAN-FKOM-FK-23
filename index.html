<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Gizi Calculator | Praktikum Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Plus Jakarta Sans', 'sans-serif'],
                        mono: ['Fira Code', 'monospace'],
                    },
                    colors: {
                        primary: {
                            50: '#eff6ff', 100: '#dbeafe', 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8', 900: '#1e3a8a',
                        },
                        surface: '#ffffff',
                        background: '#f3f4f6'
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'slide-up': 'slideUp 0.5s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #f8fafc;
            background-image: radial-gradient(#e2e8f0 1px, transparent 1px);
            background-size: 24px 24px;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9; 
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .calc-card {
            background-color: #f8fafc;
            border-left: 4px solid #3b82f6;
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: 'Fira Code', monospace;
            font-size: 0.85rem;
            color: #334155;
            margin-top: 0.5rem;
        }

        /* Hide number input arrows */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
    </style>
</head>
<body class="text-slate-800 antialiased min-h-screen flex flex-col">

    <nav class="bg-white/80 backdrop-blur-md border-b border-slate-200 sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center gap-2">
                    <div class="bg-primary-600 text-white p-2 rounded-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-slate-900 tracking-tight">GiziCalc<span class="text-primary-600">Pro</span></h1>
                        <p class="text-xs text-slate-500 font-medium">Asisten Praktikum Gizi</p>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main id="app" class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full transition-all duration-500">
        
        <section id="page-input" class="max-w-xl mx-auto animate-fade-in">
            <div class="glass-panel shadow-2xl rounded-3xl p-8 border border-white">
                <div class="text-center mb-8">
                    <h2 class="text-2xl font-bold text-slate-800">Data Pasien</h2>
                    <p class="text-slate-500">Masukkan data antropometri untuk memulai perhitungan.</p>
                </div>

                <form id="gizi-form" class="space-y-6">
                    <div class="space-y-4">
                        <div class="relative">
                            <label class="block text-sm font-semibold text-slate-700 mb-1">Umur (Tahun)</label>
                            <div class="relative">
                                <input type="number" id="umur" class="pl-10 w-full rounded-xl border-slate-200 bg-slate-50 focus:bg-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all py-3 shadow-sm" placeholder="Contoh: 20" required>
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-400 absolute left-3 top-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                </svg>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Jenis Kelamin</label>
                            <div class="grid grid-cols-2 gap-4">
                                <label class="cursor-pointer">
                                    <input type="radio" name="gender" value="laki-laki" id="gender-laki" class="peer sr-only" required>
                                    <div class="p-4 rounded-xl border-2 border-slate-100 bg-white hover:bg-slate-50 peer-checked:border-primary-600 peer-checked:bg-primary-50 transition-all flex items-center justify-center gap-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-500 peer-checked:text-primary-600" viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                                        </svg>
                                        <span class="font-medium text-slate-700 peer-checked:text-primary-700">Laki-laki</span>
                                    </div>
                                </label>
                                <label class="cursor-pointer">
                                    <input type="radio" name="gender" value="perempuan" id="gender-perempuan" class="peer sr-only" required>
                                    <div class="p-4 rounded-xl border-2 border-slate-100 bg-white hover:bg-slate-50 peer-checked:border-pink-500 peer-checked:bg-pink-50 transition-all flex items-center justify-center gap-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-500 peer-checked:text-pink-600" viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                                        </svg>
                                        <span class="font-medium text-slate-700 peer-checked:text-pink-700">Perempuan</span>
                                    </div>
                                </label>
                            </div>
                            <div id="ree-formula-display" class="hidden mt-3 text-xs text-slate-500 bg-slate-100 p-2 rounded-lg border border-slate-200">
                                <span class="font-semibold text-primary-600">Info:</span> Rumus Harris-Benedict: <span id="ree-formula-text" class="font-mono"></span>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div class="relative">
                            <label class="block text-sm font-semibold text-slate-700 mb-1">Berat (kg)</label>
                            <div class="relative">
                                <input type="number" id="bb" step="0.1" class="pl-10 w-full rounded-xl border-slate-200 bg-slate-50 focus:bg-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all py-3 shadow-sm" placeholder="55.5" required>
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-400 absolute left-3 top-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3" />
                                </svg>
                            </div>
                        </div>
                        <div class="relative">
                            <label class="block text-sm font-semibold text-slate-700 mb-1">Tinggi (cm)</label>
                            <div class="relative">
                                <input type="number" id="tb" step="0.1" class="pl-10 w-full rounded-xl border-slate-200 bg-slate-50 focus:bg-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all py-3 shadow-sm" placeholder="160" required>
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-400 absolute left-3 top-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
                                </svg>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="w-full py-4 px-6 rounded-xl bg-gradient-to-r from-primary-600 to-primary-700 hover:from-primary-700 hover:to-primary-800 text-white font-bold text-lg shadow-lg shadow-primary-500/30 transform hover:-translate-y-0.5 transition-all duration-200 focus:ring-4 focus:ring-primary-300">
                        Hitung Kebutuhan Gizi
                    </button>
                    
                    <div id="error-message" class="hidden p-4 rounded-xl bg-red-50 text-red-600 text-sm border border-red-100 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                        </svg>
                        <span id="error-text">Mohon lengkapi data.</span>
                    </div>
                </form>
            </div>
        </section>

        <section id="page-results" class="hidden animate-slide-up space-y-6">
            
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center bg-white p-4 rounded-2xl shadow-sm border border-slate-100 gap-4">
                <button id="back-button" class="flex items-center gap-2 text-slate-500 hover:text-primary-600 font-medium transition-colors px-4 py-2 rounded-lg hover:bg-slate-50">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
                    </svg>
                    Input Ulang
                </button>
                <div class="flex gap-4 divide-x divide-slate-200">
                    <div class="px-4 text-center">
                        <p class="text-xs text-slate-500 uppercase tracking-wider font-semibold">Umur</p>
                        <p id="res-umur" class="font-bold text-slate-800">-</p>
                    </div>
                    <div class="px-4 text-center">
                        <p class="text-xs text-slate-500 uppercase tracking-wider font-semibold">Gender</p>
                        <p id="res-gender" class="font-bold text-slate-800">-</p>
                    </div>
                    <div class="px-4 text-center">
                        <p class="text-xs text-slate-500 uppercase tracking-wider font-semibold">Berat</p>
                        <p id="res-bb" class="font-bold text-slate-800">-</p>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
                
                <div class="lg:col-span-4 space-y-6">
                    <div class="bg-white rounded-2xl p-6 shadow-lg border-t-4 border-indigo-500">
                        <h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                            </svg>
                            Diagnosis Gizi (IMT)
                        </h3>
                        
                        <div class="text-center py-4">
                            <span id="imt-value" class="text-5xl font-extrabold text-slate-800 tracking-tight">0.0</span>
                            <div id="imt-badge" class="inline-block px-3 py-1 rounded-full text-sm font-bold mt-2 bg-slate-100 text-slate-600">
                                Status Unknown
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="h-2 w-full bg-slate-200 rounded-full overflow-hidden flex">
                                <div class="h-full bg-blue-300 w-[30%]" title="Kurus"></div>
                                <div class="h-full bg-green-500 w-[20%]" title="Normal"></div>
                                <div class="h-full bg-yellow-400 w-[15%]" title="Gemuk"></div>
                                <div class="h-full bg-red-500 w-[35%]" title="Obesitas"></div>
                            </div>
                            <div class="flex justify-between text-[10px] text-slate-400 mt-1 font-mono">
                                <span>0</span>
                                <span>18.5</span>
                                <span>25</span>
                                <span>27</span>
                                <span>></span>
                            </div>
                        </div>

                        <details class="mt-4">
                            <summary class="text-sm text-indigo-600 font-medium cursor-pointer hover:underline">Lihat Perhitungan</summary>
                            <div class="calc-card mt-2 text-xs" id="imt-calc-detail"></div>
                        </details>
                    </div>

                    <div class="bg-white rounded-2xl p-6 shadow-sm border border-slate-200">
                        <h3 class="text-lg font-bold text-slate-800 mb-2">Energi Basal (REE)</h3>
                        <p class="text-sm text-slate-500 mb-4">Energi minimum yang dibutuhkan tubuh saat istirahat.</p>
                        <div class="flex justify-between items-end border-b pb-4 mb-4">
                            <span class="text-slate-500 text-sm">Total KEB</span>
                            <span id="keb-value" class="text-2xl font-bold text-slate-900">0 kkal</span>
                        </div>
                         <details>
                            <summary class="text-sm text-slate-600 font-medium cursor-pointer hover:underline">Rumus Harris-Benedict</summary>
                            <div class="calc-card mt-2 text-xs" id="keb-calc-detail"></div>
                        </details>
                    </div>
                </div>

                <div class="lg:col-span-8">
                    <div class="bg-white rounded-2xl shadow-lg border border-slate-100 overflow-hidden min-h-[600px] flex flex-col">
                        
                        <div class="border-b border-slate-200 bg-slate-50">
                            <div class="flex overflow-x-auto no-scrollbar snap-x" id="tab-nav">
                                </div>
                        </div>

                        <div id="tab-content" class="p-6 md:p-8 flex-grow bg-white">
                            </div>

                    </div>
                </div>

            </div>
        </section>

    </main>

    <div id="modal-container" class="hidden fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 transition-opacity duration-300">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm p-6 transform scale-100 transition-transform">
            <h3 class="text-xl font-bold text-slate-900 mb-2">Konfirmasi Kembali?</h3>
            <p class="text-slate-600 mb-6 text-sm">
                Data hasil perhitungan saat ini akan dihapus jika Anda kembali ke halaman input.
            </p>
            <div class="flex justify-end gap-3">
                <button id="modal-cancel" class="px-4 py-2 rounded-lg text-sm font-medium text-slate-600 hover:bg-slate-100 transition-colors">
                    Batal
                </button>
                <button id="modal-confirm" class="px-4 py-2 rounded-lg text-sm font-medium text-white bg-red-600 hover:bg-red-700 shadow-lg shadow-red-500/30 transition-colors">
                    Ya, Reset Data
                </button>
            </div>
        </div>
    </div>

    <script>
        // Data & Konfigurasi
        const practicums = [
            { id: "p1", name: "Diet Lambung", short: "Lambung", color: "blue", hex: "#2563eb", af: 1.2, if: 1.3, macros: { carb: 0.60, protein: 0.15, fat: 0.25 } },
            { id: "p2", name: "Diet Rendah Sisa", short: "Rendah Sisa", color: "emerald", hex: "#059669", af: 1.2, if: 1.4, macros: { carb: 0.60, protein: 0.15, fat: 0.25 } },
            { id: "p3", name: "Diet Tinggi Serat", short: "Tinggi Serat", color: "purple", hex: "#7c3aed", af: 1.3, if: 1.3, macros: { carb: 0.60, protein: 0.15, fat: 0.25 } },
            { id: "p4", name: "Diet Penyakit Hati", short: "Hati", color: "amber", hex: "#d97706", af: 1.2, if: 1.4, macros: { carb: 0.60, protein: 0.15, fat: 0.25 } },
            { id: "p5", name: "Diet Rendah Lemak", short: "Rendah Lemak", color: "rose", hex: "#e11d48", af: 1.2, if: 1.3, macros: { carb: 0.60, protein: 0.20, fat: 0.20 } }
        ];

        // Format number helper
        const fmt = (n) => parseFloat(n.toFixed(2));
        
        // Element Refs
        const form = document.getElementById('gizi-form');
        const pageInput = document.getElementById('page-input');
        const pageResults = document.getElementById('page-results');
        const errorMsg = document.getElementById('error-message');
        const tabNav = document.getElementById('tab-nav');
        const tabContent = document.getElementById('tab-content');

        // Logic Ganti Formula Text di Input
        const genderRadios = document.getElementsByName('gender');
        const reeDisplay = document.getElementById('ree-formula-display');
        const reeText = document.getElementById('ree-formula-text');

        const formulas = {
            'laki-laki': "66 + (13,7 x BB) + (5 x TB) - (6,8 x U)",
            'perempuan': "655 + (9,6 x BB) + (1,8 x TB) – (4,7 x U)"
        };

        genderRadios.forEach(radio => {
            radio.addEventListener('change', (e) => {
                reeText.textContent = formulas[e.target.value];
                reeDisplay.classList.remove('hidden');
            });
        });

        // ==========================================
        // MAIN CALCULATION
        // ==========================================
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            
            // Get Values
            const umur = parseFloat(document.getElementById('umur').value);
            const bb = parseFloat(document.getElementById('bb').value);
            const tb = parseFloat(document.getElementById('tb').value);
            const genderEl = document.querySelector('input[name="gender"]:checked');
            
            if(!umur || !bb || !tb || !genderEl) {
                errorMsg.classList.remove('hidden');
                return;
            }
            errorMsg.classList.add('hidden');

            const gender = genderEl.value;

            // 1. Set Header Summary
            document.getElementById('res-umur').textContent = `${umur} Thn`;
            document.getElementById('res-gender').textContent = gender === 'laki-laki' ? 'Laki-laki' : 'Perempuan';
            document.getElementById('res-bb').textContent = `${bb} kg / ${tb} cm`;

            // 2. Hitung IMT & Render Sidebar
            const tb_m = tb / 100;
            const imt = bb / (tb_m * tb_m);
            renderIMT(imt, bb, tb_m);

            // 3. Hitung KEB (REE) & Render Sidebar
            let keb = 0;
            if (gender === 'laki-laki') {
                keb = 66 + (13.7 * bb) + (5 * tb) - (6.8 * umur);
                renderKEB(keb, 'laki-laki', bb, tb, umur);
            } else {
                keb = 655 + (9.6 * bb) + (1.8 * tb) - (4.7 * umur);
                renderKEB(keb, 'perempuan', bb, tb, umur);
            }

            // 4. Render Tabs & Content
            renderTabs(keb);

            // 5. Switch View
            pageInput.classList.add('hidden');
            pageResults.classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });


        // ==========================================
        // RENDER FUNCTIONS
        // ==========================================

        function renderIMT(imt, bb, tb_m) {
            const elVal = document.getElementById('imt-value');
            const elBadge = document.getElementById('imt-badge');
            const elCalc = document.getElementById('imt-calc-detail');

            elVal.textContent = fmt(imt);
            
            let status = '';
            let colorClass = '';
            let bgClass = '';

            if (imt < 17.0) { status = 'Sangat Kurus'; colorClass = 'text-blue-600'; bgClass = 'bg-blue-100'; }
            else if (imt < 18.5) { status = 'Kurus'; colorClass = 'text-blue-500'; bgClass = 'bg-blue-50'; }
            else if (imt < 25.1) { status = 'Normal'; colorClass = 'text-green-600'; bgClass = 'bg-green-100'; }
            else if (imt < 27.1) { status = 'Gemuk'; colorClass = 'text-yellow-600'; bgClass = 'bg-yellow-100'; }
            else { status = 'Obesitas'; colorClass = 'text-red-600'; bgClass = 'bg-red-100'; }

            elBadge.textContent = status;
            elBadge.className = `inline-block px-4 py-1.5 rounded-full text-sm font-bold mt-2 ${bgClass} ${colorClass}`;
            elVal.className = `text-5xl font-extrabold tracking-tight ${colorClass}`;

            elCalc.innerHTML = `IMT = BB / (TB)²<br>= ${bb} / (${fmt(tb_m)})²<br>= ${fmt(imt)}`;
        }

        function renderKEB(keb, gender, bb, tb, umur) {
            document.getElementById('keb-value').textContent = `${fmt(keb)} kkal`;
            const elCalc = document.getElementById('keb-calc-detail');
            
            if(gender === 'laki-laki') {
                elCalc.innerHTML = `66 + (13.7 x ${bb}) + (5 x ${tb}) - (6.8 x ${umur})`;
            } else {
                elCalc.innerHTML = `655 + (9.6 x ${bb}) + (1.8 x ${tb}) - (4.7 x ${umur})`;
            }
        }

        function renderTabs(keb) {
            let navHtml = '';
            let contentHtml = '';

            practicums.forEach((p, index) => {
                const isActive = index === 0;
                
                // Tab Buttons
                navHtml += `
                    <button onclick="switchTab('${p.id}')" 
                        class="tab-btn px-6 py-4 text-sm font-bold whitespace-nowrap border-b-2 transition-colors duration-300 focus:outline-none flex-shrink-0 ${isActive ? `border-${p.color}-600 text-${p.color}-700 bg-${p.color}-50` : 'border-transparent text-slate-500 hover:text-slate-700 hover:bg-slate-50'}"
                        data-target="${p.id}"
                        data-color="${p.color}">
                        ${p.short}
                    </button>
                `;

                // Calculations
                const ket = keb * p.af * p.if;
                const carb_g = (p.macros.carb * ket) / 4;
                const prot_g = (p.macros.protein * ket) / 4;
                const fat_g  = (p.macros.fat * ket) / 9;

                // Limits
                const limits = (val) => ({ min: fmt(val * 0.9), max: fmt(val * 1.1) });
                const carb_l = limits(carb_g);
                const prot_l = limits(prot_g);
                const fat_l  = limits(fat_g);

                // Tab Content Pane
                contentHtml += `
                    <div id="${p.id}" class="tab-pane ${isActive ? '' : 'hidden'} animate-fade-in space-y-8">
                        
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-end border-b border-slate-100 pb-6">
                            <div>
                                <h2 class="text-3xl font-bold text-${p.color}-700 mb-2">${p.name}</h2>
                                <div class="flex gap-3 text-sm">
                                    <span class="px-3 py-1 rounded bg-slate-100 text-slate-600 font-medium">AF: ${p.af}</span>
                                    <span class="px-3 py-1 rounded bg-slate-100 text-slate-600 font-medium">IF: ${p.if}</span>
                                </div>
                            </div>
                            <div class="mt-4 md:mt-0 text-right">
                                <p class="text-sm text-slate-500 font-medium mb-1">Energi Total (KET)</p>
                                <p class="text-4xl font-extrabold text-${p.color}-600">${fmt(ket)} <span class="text-xl text-slate-400">kkal</span></p>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="bg-white rounded-xl p-5 border border-slate-100 shadow-sm hover:shadow-md transition-shadow relative overflow-hidden group">
                                <div class="absolute top-0 left-0 w-1 h-full bg-${p.color}-500"></div>
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-bold text-slate-700">Karbohidrat</h4>
                                    <span class="text-xs font-bold text-${p.color}-600 bg-${p.color}-50 px-2 py-1 rounded">${fmt(p.macros.carb*100)}%</span>
                                </div>
                                <p class="text-3xl font-bold text-slate-800 mb-1">${fmt(carb_g)}<span class="text-sm text-slate-400 font-normal ml-1">g</span></p>
                                
                                <div class="w-full bg-slate-100 rounded-full h-1.5 mb-3">
                                    <div class="bg-${p.color}-500 h-1.5 rounded-full" style="width: ${p.macros.carb*100}%"></div>
                                </div>

                                <div class="text-xs text-slate-500 bg-slate-50 p-2 rounded">
                                    <div class="flex justify-between mb-1"><span>Min (-10%)</span> <span class="font-mono text-slate-700">${carb_l.min} g</span></div>
                                    <div class="flex justify-between"><span>Max (+10%)</span> <span class="font-mono text-slate-700">${carb_l.max} g</span></div>
                                </div>
                            </div>

                            <div class="bg-white rounded-xl p-5 border border-slate-100 shadow-sm hover:shadow-md transition-shadow relative overflow-hidden group">
                                <div class="absolute top-0 left-0 w-1 h-full bg-${p.color}-500 opacity-70"></div>
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-bold text-slate-700">Protein</h4>
                                    <span class="text-xs font-bold text-${p.color}-600 bg-${p.color}-50 px-2 py-1 rounded">${fmt(p.macros.protein*100)}%</span>
                                </div>
                                <p class="text-3xl font-bold text-slate-800 mb-1">${fmt(prot_g)}<span class="text-sm text-slate-400 font-normal ml-1">g</span></p>
                                
                                <div class="w-full bg-slate-100 rounded-full h-1.5 mb-3">
                                    <div class="bg-${p.color}-500 opacity-70 h-1.5 rounded-full" style="width: ${p.macros.protein*100}%"></div>
                                </div>

                                <div class="text-xs text-slate-500 bg-slate-50 p-2 rounded">
                                    <div class="flex justify-between mb-1"><span>Min (-10%)</span> <span class="font-mono text-slate-700">${prot_l.min} g</span></div>
                                    <div class="flex justify-between"><span>Max (+10%)</span> <span class="font-mono text-slate-700">${prot_l.max} g</span></div>
                                </div>
                            </div>

                            <div class="bg-white rounded-xl p-5 border border-slate-100 shadow-sm hover:shadow-md transition-shadow relative overflow-hidden group">
                                <div class="absolute top-0 left-0 w-1 h-full bg-${p.color}-500 opacity-50"></div>
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-bold text-slate-700">Lemak</h4>
                                    <span class="text-xs font-bold text-${p.color}-600 bg-${p.color}-50 px-2 py-1 rounded">${fmt(p.macros.fat*100)}%</span>
                                </div>
                                <p class="text-3xl font-bold text-slate-800 mb-1">${fmt(fat_g)}<span class="text-sm text-slate-400 font-normal ml-1">g</span></p>
                                
                                <div class="w-full bg-slate-100 rounded-full h-1.5 mb-3">
                                    <div class="bg-${p.color}-500 opacity-50 h-1.5 rounded-full" style="width: ${p.macros.fat*100}%"></div>
                                </div>

                                <div class="text-xs text-slate-500 bg-slate-50 p-2 rounded">
                                    <div class="flex justify-between mb-1"><span>Min (-10%)</span> <span class="font-mono text-slate-700">${fat_l.min} g</span></div>
                                    <div class="flex justify-between"><span>Max (+10%)</span> <span class="font-mono text-slate-700">${fat_l.max} g</span></div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-8 pt-6 border-t border-slate-100">
                            <details class="group">
                                <summary class="flex items-center gap-2 cursor-pointer text-slate-500 hover:text-${p.color}-600 font-medium transition-colors">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 transition-transform group-open:rotate-90" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                                    </svg>
                                    Lihat Detail Perhitungan Manual
                                </summary>
                                <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4 animate-fade-in">
                                    <div>
                                        <p class="text-xs font-semibold text-slate-400 mb-1">KET (Energi Total)</p>
                                        <div class="calc-card bg-white border-l-4 border-${p.color}-400">
                                            ${fmt(keb)} (KEB) x ${p.af} (AF) x ${p.if} (IF)<br>
                                            = <strong>${fmt(ket)} kkal</strong>
                                        </div>
                                    </div>
                                    <div>
                                        <p class="text-xs font-semibold text-slate-400 mb-1">Karbohidrat</p>
                                        <div class="calc-card bg-white border-l-4 border-${p.color}-400">
                                            (${fmt(p.macros.carb)} x ${fmt(ket)}) / 4<br>
                                            = <strong>${fmt(carb_g)} g</strong>
                                        </div>
                                    </div>
                                    <div>
                                        <p class="text-xs font-semibold text-slate-400 mb-1">Protein</p>
                                        <div class="calc-card bg-white border-l-4 border-${p.color}-400">
                                            (${fmt(p.macros.protein)} x ${fmt(ket)}) / 4<br>
                                            = <strong>${fmt(prot_g)} g</strong>
                                        </div>
                                    </div>
                                    <div>
                                        <p class="text-xs font-semibold text-slate-400 mb-1">Lemak</p>
                                        <div class="calc-card bg-white border-l-4 border-${p.color}-400">
                                            (${fmt(p.macros.fat)} x ${fmt(ket)}) / 9<br>
                                            = <strong>${fmt(fat_g)} g</strong>
                                        </div>
                                    </div>
                                </div>
                            </details>
                        </div>
                    </div>
                `;
            });

            tabNav.innerHTML = navHtml;
            tabContent.innerHTML = contentHtml;
        }

        // ==========================================
        // UI INTERACTIONS
        // ==========================================

        // Tab Switching Logic
        window.switchTab = function(targetId) {
            // Update Buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                const color = btn.dataset.color;
                if(btn.dataset.target === targetId) {
                    btn.className = `tab-btn px-6 py-4 text-sm font-bold whitespace-nowrap border-b-2 transition-colors duration-300 focus:outline-none flex-shrink-0 border-${color}-600 text-${color}-700 bg-${color}-50`;
                } else {
                    btn.className = `tab-btn px-6 py-4 text-sm font-bold whitespace-nowrap border-b-2 transition-colors duration-300 focus:outline-none flex-shrink-0 border-transparent text-slate-500 hover:text-slate-700 hover:bg-slate-50`;
                }
            });

            // Update Content
            document.querySelectorAll('.tab-pane').forEach(pane => {
                if(pane.id === targetId) {
                    pane.classList.remove('hidden');
                } else {
                    pane.classList.add('hidden');
                }
            });
        };

        // Modal Logic
        const modal = document.getElementById('modal-container');
        document.getElementById('back-button').addEventListener('click', () => modal.classList.remove('hidden'));
        document.getElementById('modal-cancel').addEventListener('click', () => modal.classList.add('hidden'));
        
        document.getElementById('modal-confirm').addEventListener('click', () => {
            modal.classList.add('hidden');
            pageResults.classList.add('hidden');
            pageInput.classList.remove('hidden');
            // Reset form fields but keep values for convenience? No, strict reset requested.
            // document.getElementById('gizi-form').reset(); 
            // reeDisplay.classList.add('hidden');
        });

    </script>
</body>
</html>
